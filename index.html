<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>OAuth Authentication</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
</head>

<body>
    <header>
        <nav class="navbar border-bottom navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand" href="https://github.com/dnd-mdn">dnd-mdn</a>
                <div class="d-flex">
                    <button id="gh-signin" class="btn btn-outline-primary">GitHub: Sign in</button>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <div class="container my-2">
            <h1 class="h3 mt-4">Sign in with GitHub</h1>
            <p class="lead">Simplifying our content management through GitHub integration</p>

            <div id="authenticated" class="alert alert-success mt-3 d-none" role="alert">
                You are signed in as <a id="gh-login" target="_blank">Username</a>
            </div>
            <div id="unauthenticated" class="alert alert-warning mt-3 d-none" role="alert">
                You are not signed in
            </div>

            <h2 class="h4 mt-4">üìñ Overview</h2>
            <p>Our frontend applications are an interface to simplify managing our content. A major benefit is the ability to run them in any web browser, even on DWAN üò≤. GitHub then acts as the backend to store our content, but it can do much more than that. It provides an entire ecosystem of version control and hosting tools.</p>
            <h2 class="h4 mt-4">üîê Permissions</h2>
            <p>By signing in with GitHub, you are allowing applications to act on your behalf. They can only perform actions on projects that you are allowed to contribute to, so you may need to request access from the owner. You can later review or revoke the application <a href="https://github.com/settings/connections/applications/6502d8679dcf3f0105f8" target="_blank">permissions</a>.</p>
            <h2 class="h4 mt-4">ü™≤ Issues</h2>
            <p>Create a <a href="https://github.com/dnd-mdn/oauth/issues/new" target="_blank">new issue</a> with a detailed description of the problem.</p>

            <pre id="test"></pre>
        </div>
    </main>


    <script type="module">
        import { client } from './oauth.js'

        client.user().then(user => {
            if (user) {
                const a = document.getElementById('gh-login')

                a.href = user.html_url
                a.innerHTML = user.login

                document.getElementById('authenticated').classList.remove('d-none')

                client.rest.auth().then(console.log)

                client.rest.orgs.getMembershipForAuthenticatedUser({
                    org: 'dnd-mdn'
                }).then(console.log)

            } else {
                document.getElementById('unauthenticated').classList.remove('d-none')
            }
        })

        console.log(client)
    </script>

</body>

</html>