<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>OAuth Authentication</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
</head>

<body>
    <header>
        <nav class="navbar border-bottom navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand" href="https://github.com/dnd-mdn">dnd-mdn</a>
                <div class="d-flex">
                    <a id="gh-signin" href="#" class="nav-link text-primary">Sign in with GitHub</a>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <div class="container my-2">
            <h1 class="h3 mt-4">Sign in with GitHub</h1>
            <p class="lead">Simplifying our content management through GitHub integration</p>
            <p>This page is an example of signing in to our frontend applications with your GitHub account.</p>
            <h2 class="h4 mt-4 mb-3">ðŸ‘¤ User info</h2>
            <div id="gh-user">
                <div class="spinner-border spinner-border-sm text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        import { rest } from './oauth.js'

        async function userHTML() {
            const auth = await rest.auth()

            if (auth.type !== 'token') {
                return '<p>Sign in to view account status</p>'
            }

            let html = '<h3 class="h5 mb-0">Role</h3>'

            try {
                const { data } = await rest.orgs.getMembershipForAuthenticatedUser({ org: 'dnd-mdn' })
                html += `<p><a href="https://github.com/orgs/dnd-mdn/people" target="_blank">${data.role}</a></p>`
            } catch (e) {
                return html + '<p><span class="text-error">None</span> - You are not a member of the <a href="https://github.com/dnd-mdn">dnd-mdn</a> organization</p>'
            }

            return html
        }

        // Display result
        document.getElementById('gh-user').innerHTML = await userHTML()

    </script>

</body>

</html>